#*
 * Aipo is a groupware program developed by Aimluck,Inc.
 * Copyright (C) 2004-2011 Aimluck,Inc.
 * http://www.aipo.com
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *#

## ---------------------------------------------------------------------------
#AUIcontentsAreaHeader()
<div id="auiThreeClumns">
<div id="auiThreeClumnsInner">
<div class="auiSummaryMeta clearfix">
<form class="auiSearch floatLeft" style="margin-right:1em;" name="blogForm$!portlet.ID" id="blogSearchForm$!portlet.ID" action="#" method="post" onsubmit="aipo.blog.onSubmitSerchButton(this ,'$!jslink.getPortletById($!portlet.ID).addQueryData("template","BlogEntryListScreen").addQueryData("themeid", $!result.ThemeId).addQueryData("ownerid", ${result.OwnerId})', '$!portlet.ID');return false;">
<input class="text floatLeft" type="text" name="keyword" id="keyword" style="margin-right:5px;"maxlength="100" value="$!result.Keyword">
<a class="auiButtonSearch floatLeft" onclick="aimluck.io.setHiddenValue(this);dojo.byId('blogSearchForm$!portlet.ID').submit();">検索</a>
</form>
</div>
<div class="auiSummaryMeta clearfix">
#if ($result.List.size() != 0)
#AUIajaxpageview('BlogEntryListScreen' $result)
#end
</div>
#AUIsearchresult($!result.Keyword.toString())

#if($result.List.size() == 0)
<div class="message">指定された条件に該当する記事はありません。</div>
#else
<div id="auiBlogEntries">
#foreach ($record in $result.List)
<div class="entry clearfix">
<div class="avatar">
<a href="$!utils.escapeXML($!jslink.getAction('controls.Maximize',$!portlet.ID).addQueryData('eventSubmit_doBlog_entry_list_user','1').addQueryData('view_uid',${record.OwnerId}).addQueryData('view_month', 'none'))">
#if(${record.hasPhoto()})
<img src="$!utils.escapeXML($jslink.getTemplate("FileuploadFacePhotoScreen").addQueryData("uid", ${record.OwnerId}).addQueryData('width', '32').addQueryData('height', '32'))" alt="${record.OwnerName}" border="0" width="32" height="32" style="vertical-align:middle" />
#else
<img src="images/common/nophoto.gif" alt="${record.OwnerName}" width="32" height="32" border="0" />
#end
</a>
</div>
<div class="entryBody">
<div class="entryHeader"><h2><a href="javascript:void(0);" onclick="aipo.common.showDialog('$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","BlogDetailScreen").addQueryData("entityid",$record.EntryId))', '$!portlet.ID', aipo.blog.onLoadBlogDetailDialog );">${record.Title}</a></h2></div>
<div class='entryText'>${record.Note}</div>
<div class="entryFooter">
<div class="floatRight">${record.TitleDate}｜${record.OwnerName}</div>
<a href="javascript:void(0);" onclick="aipo.common.showDialog('$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","BlogDetailScreen").addQueryData("entityid",$record.EntryId))', '$!portlet.ID', aipo.blog.onLoadBlogDetailDialog );">コメント#if($record.CommentsNum > 0)（$record.CommentsNum）#end</a>｜
<a href="javascript:void(0);" onclick="aipo.common.showDialog('$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","BlogThemaDetailScreen").addQueryData("entityid",$!record.ThemaId))');">$!record.ThemaName</a>｜
#if($result.Editable)
<a href="javascript:void(0);" onclick="aipo.common.showDialog('$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","BlogEntryFormScreen").addQueryData('eventSubmit_doBlog_entry_form','1').addQueryData('entityid',$record.EntryId))','$!portlet.ID',aipo.blog.onLoadBlogDialog);">編集 </a>｜
#end
<a href="javascript:void(0);" onclick="aipo.common.showDialog('$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","BlogDetailScreen").addQueryData("entityid",$record.EntryId))', '$!portlet.ID', aipo.blog.onLoadBlogDetailDialog );">続きを読む</a>
</div>
</div>
</div>
#end
</div>
#end
<div class="auiSummaryMeta clearfix">
#if ($result.List.size() != 0)
#AUIajaxpageview('BlogEntryListScreen' $result)
#end
</div>
</div>
</div>
<div id="auiThreeColumnWidgets">
<div class="auiWidget clearfix">
<form class="auiForm">
<select name="groupId" onChange="aipo.viewPage(this.options[this.selectedIndex].value, '$!portlet.ID')" class="wide">
<option value="$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","BlogEntryListScreen").addQueryData("groupid","LoginUser").addQueryData("target_user_id", "all"))">すべてのグループ</option>
#foreach( $record in $!result.MyGroupList )
<option value="$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","BlogEntryListScreen").addQueryData("groupid","$!{record.Name.toString()}"))" #if($!result.GroupId == $!record.Name.toString()) selected #set($groupName = $!record.Name) #end>$!record.AliasName</option>
#end
#if(($result.MyGroupList.size() > 0) && ($result.PostMap.size() > 0))
<option value="$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","BlogEntryListScreen").addQueryData("groupid","LoginUser"))">----------</option>
#end
#foreach( $record in $!result.PostMap )
<option value="$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","BlogEntryListScreen").addQueryData("groupid","$!{record.GroupName.toString()}"))" #if($!result.GroupId == $!record.GroupName.toString()) selected #set($groupName = $!record.GroupName) #end>$!record.PostName</option>
#end
</select>
</form>
<ul class="auiAvatarList">
#foreach($user in $!result.UserList)
<li#if ($!result.OwnerId == $!user.UserId.toString()) class="active"#end><a href="javascript:void(0);" onclick="aipo.viewPage('$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","BlogEntryListScreen").addQueryData("ownerid", $user.UserId))', '$!portlet.ID');">
#if($user.hasPhoto)
<img src="" width="32" height="32" alt="${user.AliasName}" />
#else
<img src="images/common/nophoto.gif" alt="${user.AliasName}" width="32" height="32" border="0" />
#end
${user.AliasName}</a></li>
#end
</ul>
</div>
</div>
#AUIcontentsAreaFooter()
#parse("/portlets/html/ja/blog-widgets.vm")