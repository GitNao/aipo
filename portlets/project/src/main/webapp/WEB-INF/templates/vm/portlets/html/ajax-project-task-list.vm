#*
 * Aipo is a groupware program developed by Aimluck,Inc.
 * Copyright (C) 2004-2011 Aimluck,Inc.
 * http://www.aipo.com
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Project Management Portlet was developed by Advance,Inc.
 * http://www.a-dvance.co.jp/
 *#
## ---------------------------------------------------------------------------
#set ($indicator_id = "indicator-list-")
#set ($orderProjectTask = $!jslink.getPortletById($!portlet.ID).addQueryData("template","ProjectTaskChangeTurnFormScreen").addQueryData("projectid","$result.SelectedProjectId"))
#set ($baselink = "$!jslink.getPortletById($!portlet.ID).addQueryData('template','ProjectTaskListScreen')")
#set ($progressJsonScreen = $!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","ProjectTaskProgressFormJSONScreen")))

## ---------------------------------------------------------------------------
#AUIcontentsAreaHeader()

#if(!$result.AllProject)
	<div class="message">プロジェクトが登録されていません。</div>
#elseif(!$result.List)
	<div class="message">プロジェクトを選択してください。</div>
#else
    #AUISummaryDiv()
    <div class="floatRight">
    	<div class="auiSelectButton">
    		<ul>
    			#set($tab = ["タスク一覧", "task_list","$!jslink.getPortletById($!portlet.ID).addQueryData('template','ProjectTaskListScreen')"])
    			<li class="active"><a class="first" style="width:7em;" href="javascript:void(0);" onclick="aipo.viewPage('$!utils.escapeXML($tab.get(2))', '$!portlet.ID');"><span>$tab.get(0)</span></a></li>
    			#set($tab = ["ガントチャート", "gantt_chart", "$!jslink.getPortletById($!portlet.ID).addQueryData('template','ProjectGanttChartScreen')"])
    			<li><a class="last" style="width:9em;" href="javascript:void(0);" onclick="aipo.viewPage('$!utils.escapeXML($tab.get(2))', '$!portlet.ID');aipo.project.reloadProgress();"><span>$tab.get(0)</span></a></li>
    		</ul>
    	</div>
    </div>
    #AUISummaryDivfooter()
    #AUISummaryFilterDivHeader()
    #AUISearchHeader("searchForm_" "searchForm_" "$!jslink.getPortletById($!portlet.ID)" "aimluck.io.postViewPage(this, '$!portlet.ID', 'search-${indicator_id}'); return false;")
    <input type="hidden" id="baseuri_$!portlet.ID" value='$!jslink.getPortletById($!portlet.ID).addQueryData("template","ProjectTaskListScreen")' />
    <input type="hidden" name="template" value="ProjectTaskListScreen"/>
    <div class="filterInputField">
    	<div class="filters" id="filters_$!portlet.ID"></div>
    	<a href="javascript:void(0)" class="filterDropDrawer menubarOpenButton" ><i class="auiIcon auiIconArwBottom"></i></a>
    	<input class="text floatLeft long" type="text" name="keyword" id="q$!{portlet.ID}" value="$!result.targetKeyword" />
    </div>
    #AUIButtonSearch("dojo.byId('searchForm_$!portlet.ID').onsubmit();" "$l10n.TODO_SEARCH")
    #AUISearchIndicator()
    #AUISearchFooter()
    #AUISummaryFilterDivFooter()
	
    #AUISummaryDiv()
    <select name="" id="">
    #foreach($rate in [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100])
    	<option value="${rate}">${rate}%</option>
    #end
    </select>
    -
    <select name="" id="">
    #foreach($rate in [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100])
    	<option value="${rate}" #if(${rate} == 100) selected="selected" #end>${rate}%</option>
    #end
    </select>
    <label><input type="checkbox">進捗遅れのみ表示</label>
    #AUISummaryDivfooter()
    #if($result.List.size() == 0)
		<div class="message">指定された条件に該当するレコードはありません。</div>
    #else
        #if("$result.List.size()" != "0")
            #AUISummaryDiv()
            #AUIajaxpageview('ProjectTaskListScreen' $result)
            #AUISummaryDivfooter()
        #end
        #ALajaxIndicator("$indicator_id" "$!portlet.ID" "")
        <div id="messageDiv-$!portlet.ID"></div>
        #AUIrowMTableWide()
        	<tr>
        		#ALtdhead("タスク名")
        		#ALtdheadAtt("分類" "class='thin'")
        		#ALtdheadAtt("ステータス" "class='thin'")
        		#ALtdheadAtt("担当者" "class='wName'")
        		#ALtdheadAtt("進捗率" "class='thin'")
        		#ALtdheadAtt("実績工数" "class='thin'")
        		#ALtdheadAtt("予定工数" "class='thin'")
                #ALtdheadAtt("開始日" "class='w10'")
        		#ALtdheadAtt("期日" "class='w10'")
        	</tr>
        	#foreach ($record in $result.List)
        	<tr>
        		#ALtdcellheaderAtt('class="auiMTCaption"')
        		<div>
        			$!record.IndentString<a href="javascript:void(0);" onclick="aipo.common.showDialog('$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","ProjectTaskDetailScreen").addQueryData("entityid",$record.TaskId))');">$!record.TaskName</a>
        		</div>
        		#ALtdcellfooter()
        		#ALtdcellAtt("<div>$!record.StatusString</div>" 'nowrap="nowrap"')
        		#ALtdcellAtt("<div>$!record.MemberListString</div>" '')
        		#ALtdcellAtt("<div>$!{record.EndPlanDate.Year}年$!{record.EndPlanDate.Month}月$!{record.EndPlanDate.Day}日</div>" 'nowrap="nowrap"')
        		#ALtdcellheaderAtt('nowrap="nowrap" class="mb_hide" ')
        		#if(!$!record.HasChildrenForForm)
            		<select name="progress_rate" #if($!{record.Delay}) style="color:red;" #end onchange="aimluck.io.selectPost({name: this.name, value: this.value, taskId: '$record.taskId', secid: '$secid'}, '$progressJsonScreen', '$indicator_id', '$!portlet.ID', aipo.project.onReceiveMessage)">
            		#foreach($rate in [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100])
            			<option #if($!{record.ProgressRate.toString()} == "${rate}") selected="selected" #end value="${rate}">${rate}%</option>
            		#end
            		</select>
        		#else
                    <span #if($!{record.Delay}) style="color:red;" #end>$!{record.ProgressRate.toString()}%</span>
        		#end
        		#ALtdcellfooter()
        		#ALtdcellAtt("<div>$!{record.WorkloadFormat}h</div>" 'class="center mb_hide"')
        		#ALtdcellAtt("<div>$!{record.PlanWorkloadFormat}h</div>" 'class="center mb_hide"')
        		#ALtdcellAtt("<div>$!{record.StartPlanDate.Year}年$!{record.StartPlanDate.Month}月$!{record.StartPlanDate.Day}日</div>" 'class="mb_hide"')
        		#ALtdcellAtt("<div>$!{record.EndPlanDate.Year}年$!{record.EndPlanDate.Month}月$!{record.EndPlanDate.Day}日</div>" 'class="mb_hide"')
        	</tr>
        	#end
    	#AUItablefooter()
    	#AUISummaryDiv()
    	#AUIajaxpageview('ProjectTaskListScreen' $result)
    	#AUISummaryDivfooter()
    #end
#end
#AUIcontentsAreaFooter()

#parse("/portlets/html/ja/project-widgets.vm")

