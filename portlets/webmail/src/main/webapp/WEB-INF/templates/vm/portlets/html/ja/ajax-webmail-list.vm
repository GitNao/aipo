#*
 * Aipo is a groupware program developed by Aimluck,Inc.
 * Copyright (C) 2004-2011 Aimluck,Inc.
 * http://www.aipo.com
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *#

## ---------------------------------------------------------------------------
#if($!result.currentTab == "receive")
#set($person = "差出人")
#else
#set($person = "受取人")
#end
#set ($newUrl1 = $!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","WebMailFormScreen").addQueryData("entityid","new")))
#set ($newUrl2 = $!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","WebMailAccountFormScreen").addQueryData('entityid',$result.AccountId)))
#set ($newUrl3 = $!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","WebMailListScreen").addQueryData("mode","recieve")))
#set ($newUrl4 = $!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","WebMailFolderFormScreen").addQueryData("entityid","new")))
#set ($submenulist = [["メールを作成する","","themes/$!theme/images/icon/icon_add.gif"], ["アカウントを編集する","javascript:aipo.common.showDialog('$newUrl2','$!portlet.ID', aipo.webmail.onLoadMailAccountDialog);","images/icon/icon_edit.gif"], ["メールを受信する","javascript:aipo.viewPage('$newUrl3','$!portlet.ID');aipo.webmail.onProcessingTimer();","themes/$!theme/images/icon/webmail_receive_mail.gif"], ["フォルダを作成する","javascript:aipo.common.showDialog('$newUrl4','$!portlet.ID');aipo.webmail.onProcessingTimer();","images/webmail/webmail_folder_add.gif"]])
#set ($tabs = [["受信トレイ", "receive","$!jslink.getPortletById($!portlet.getID()).addQueryData('template','WebMailListScreen').addQueryData('eventSubmit_doWebmail_show_received_mails','1').addQueryData('tab','receive')"], ["送信トレイ", "sent","$!jslink.getPortletById($!portlet.getID()).addQueryData('template','WebMailListScreen').addQueryData('eventSubmit_doWebmail_show_sent_mails','1').addQueryData('tab','sent')"]])
#set ($indicator_id = "indicator-list-")
#set ($StatStr = $!{result.StatStr})
#set ($type = "mail")
## ---------------------------------------------------------------------------

##ALsubmenubar($submenulist "")

#AUIcontentsAreaHeader()

#if($!result.AccountId == 0)
メールアカウントを選択してください。<a href="javascript:aipo.common.showDialog('$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","WebMailAccountFormScreen").addQueryData("entityid","new"))');">メールアカウントが未登録の場合は、こちらからご登録ください。</a>
#else



#if(($errmsgs) && ($errmsgs.toString() != ""))
#ALerrmsg($errmsgs)
#else
#ALajaxIndicator("${indicator_id}" "$!{portlet.ID}" "")
#ALajaxlistformheader('Webメール')

#if($StatStr && !($StatStr == ''))
<div class="spaceBottom"><div class="indicator" id="indicator-$portlet_id">$StatStr</div></div>
#end
#if($!result.List && $!result.List.size() <= 0)
<div class="auiSummaryMeta clearfix">
#if($!result.currentTab == "receive")
<div class="message floatLeft">受信メールはありません。</div>
#else
<div class="message floatLeft">送信メールはありません。</div>
#end
<a class="auiButton" title="メール受信" href="javascript:aipo.viewPage('$!jslink.getPortletById($!portlet.ID).addQueryData('template','WebMailListScreen').addQueryData('mode','recieve')', '$!portlet.ID');">
	<span><img src='images/icon/icon_reload.gif' width='18' height='18' alt='メール受信'></span>
</a>
</div>
#else
<div class="auiSummaryMeta clearfix">
<div class="floatLeft auiForm">
#if($!result.currentTab == "receive")
#AUIajaxbuttonCheckboxAction('既読にする' "$!jslink.getPortletById($!portlet.ID).addQueryData('template','WebMailFormJSONScreen').addQueryData('mode','multi_read')" "$indicator_id" "$!portlet.ID" "aipo.webmail.onReceiveMessage")
#end
#AUIajaxbuttonCheckboxDelete('削除する' "$!jslink.getPortletById($!portlet.ID).addQueryData('template','WebMailFormJSONScreen').addQueryData('mode','multi_delete')" "$indicator_id" "$!portlet.ID" "aipo.webmail.onReceiveMessage")
#if(($!result.FolderList.size() > 1) && ($!result.currentTab == "receive"))
#ALselectpdheader('move_folder' '12em' "if(this.selectedIndex != 0)aimluck.io.ajaxCheckboxActionSubmit(this, '$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData('template','WebMailFormJSONScreen').addQueryData('mode','multi_move'))', '$indicator_id', '$!portlet.ID', aipo.webmail.onReceiveMessage);this.selectedIndex = 0;")
<option value="">フォルダ移動</option>
#foreach($record in $!result.FolderList)
#if($result.FolderId != $record.FolderId)
<option value="${record.FolderId}">${record.FolderName}</option>
#end
#end
#ALselectfooter()
#end
<a class="auiButton" title="メール受信" href="javascript:aipo.viewPage('$!jslink.getPortletById($!portlet.ID).addQueryData('template','WebMailListScreen').addQueryData('mode','recieve')', '$!portlet.ID');">
	<span><img src='images/icon/icon_reload.gif' width='18' height='18' alt='メール受信'></span>
</a>

</div>
#AUIajaxpageview('WebMailListScreen' $result)
</div>
#AUIrowTableWide()
<tr>
#ALtdheadThin("#ALswitchCheckbox()")
##ALtdheadThin("#ALajaxsort('read_flg' '状態' $result 'WebMailListScreen')")
#ALtdheadAtt("#ALajaxsort('person' $person $result 'WebMailListScreen')" 'style="width:10em;"')
#ALtdhead("#ALajaxsort('subject' '件名' $result 'WebMailListScreen')")
#ALtdheadAtt("#ALajaxsort('date' '日付' $result 'WebMailListScreen')" 'style="width:6em;"')
##ALtdheadThin('容量')
##ALtdheadThin(' ')
##ALtdheadThin(' ')
</tr>
#foreach ($record in $result.List)
<tr>
#ALtdcellAtt("<input name='check$!record.MailId' type='checkbox' value='$!record.MailId' />" 'align="center"')
##if($!record.hasAttachments())
##ALtdcellAtt("<img src='$!record.ReadImage' alt='$!record.ReadImageDescription' title='$!record.ReadImageDescription' /><img src='$!record.WithFilesImage' alt='$!record.WithFilesImageDescription' title='$!record.WithFilesImageDescription' />" 'align="center" nowrap')
##else
##ALtdcellAtt("<img src='$!record.ReadImage' alt='$!record.ReadImageDescription' title='$!record.ReadImageDescription' />" 'align="center"')
##end
#if(($!record.Subject) && ($!record.getSubject().toString() != ""))
#set($MailSubject = $!record.Subject)
#elseif($!record.Subject)
#set($MailSubject = "無題")
#end

#ALtdcellAtt("<div>$!record.Person</div>" 'align="left"')
#ALtdcellheader()
<div>
<a href='javascript:void(0);' onclick='aipo.common.showDialog("$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData('eventSubmit_doWebmail_show_mail','1').addQueryData('template','WebMailDetailScreen').addQueryData('entityid',$record.MailId).addQueryData('tab', $!result.currentTab))");'>
#if($!record.isRead())
$MailSubject
#else
<strong>$MailSubject</strong>
#end
</a>
</div>
#ALtdcellfooter()
#ALtdcellAtt("$!{record.Date.Month}月$!{record.Date.Day}日" 'class="right" nowrap="nowrap"')
</tr>
#end
#AUItablefooter()
<div class="auiSummaryMeta clearfix">
<div class="floatLeft auiForm">
#if($!result.currentTab == "receive")
#AUIajaxbuttonCheckboxAction('既読にする' "$!jslink.getPortletById($!portlet.ID).addQueryData('template','WebMailFormJSONScreen').addQueryData('mode','multi_read')" "$indicator_id" "$!portlet.ID" "aipo.webmail.onReceiveMessage")
#end
#AUIajaxbuttonCheckboxDelete('削除する' "$!jslink.getPortletById($!portlet.ID).addQueryData('template','WebMailFormJSONScreen').addQueryData('mode','multi_delete')" "$indicator_id" "$!portlet.ID" "aipo.webmail.onReceiveMessage")
#if(($!result.FolderList.size() > 1) && ($!result.currentTab == "receive"))
#ALselectpdheader('move_folder' '12em' "if(this.selectedIndex != 0)aimluck.io.ajaxCheckboxActionSubmit(this, '$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData('template','WebMailFormJSONScreen').addQueryData('mode','multi_move'))', '$indicator_id', '$!portlet.ID', aipo.webmail.onReceiveMessage);this.selectedIndex = 0;")
<option value="">フォルダ移動</option>
#foreach($record in $!result.FolderList)
#if($result.FolderId != $record.FolderId)
<option value="${record.FolderId}">${record.FolderName}</option>
#end
#end
#ALselectfooter()
#end
</div>
#AUIajaxpageview('WebMailListScreen' $result)
</div>
#end
#if($result.CurrentPage > 1)
<input type="hidden" id="page_start" name="page_start" value="$result.CurrentPage" />
#end
#if($StatStr && !($StatStr == ''))
#set ($mailScreenUrl = $!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","WebMailListScreen")))
<input type="hidden" id="receiving" name="receiving" value="$mailScreenUrl" />
<input type="hidden" id="receivingPid" name="receivingPid" value="$!portlet.ID" />
#end
#ALformfooter()
#end
#end
#AUIcontentsAreaFooter()
#parse("/portlets/html/ja/webmail-widgets.vm")
