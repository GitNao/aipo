#*
 * Aipo is a groupware program developed by Aimluck,Inc.
 * Copyright (C) 2004-2011 Aimluck,Inc.
 * http://www.aipo.com
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *#

## ---------------------------------------------------------------------------
#if  ($!result.TargetUserId && ($!result.TargetUserId != "all"))
#set ($target_username = $!result.getUserFullName($!result.TargetUserId))
#set ($action_create_node = "$!jslink.getPortletById($!portlet.ID).addQueryData('eventSubmit_doNote_create_note','1').addQueryData('target_user_id',$!result.TargetUserId)")
#set ($action_received_notes = "$!jslink.getPortletById($!portlet.ID).addQueryData('eventSubmit_doNote_list','1').addQueryData('tab','received_notes').addQueryData('target_user_id', $!result.TargetUserId)")
#set ($action_sent_notes = "$!jslink.getPortletById($!portlet.ID).addQueryData('eventSubmit_doNote_list','1').addQueryData('tab','sent_notes').addQueryData('target_user_id', $!result.TargetUserId)")
#else
#set ($action_create_node = "$!jslink.getPortletById($!portlet.ID).addQueryData('eventSubmit_doNote_create_note','1')")
#set ($action_received_notes = "$!jslink.getPortletById($!portlet.ID).addQueryData('eventSubmit_doNote_list','1').addQueryData('tab','received_notes')")
#set ($action_sent_notes = "$!jslink.getPortletById($!portlet.ID).addQueryData('eventSubmit_doNote_list','1').addQueryData('tab','sent_notes')")
#end
##set ($tabs = [["受信履歴", "received_notes", "$!jslink.getPortletById($!portlet.ID).addQueryData('template','NoteListScreen').addQueryData('tab','received_notes')"], ["送信履歴", "sent_notes", "$!jslink.getPortletById($!portlet.ID).addQueryData('template','NoteListScreen').addQueryData('tab','sent_notes')"]])
#if ($!result.currentTab == 'received_notes')
#set($colcount = 8)
#set ($isReceive = true)
#else
#set($colcount = 7)
#set ($isReceive = false)
#end
#set ($indicator_id = "indicator-list-")
## ---------------------------------------------------------------------------

#AUIcontentsAreaHeader()

##<div class="auiSummaryMeta clearfix">
##ALajaxlistformheaderonsubmitOption('note_ajaxsearch' "aipo.note.onSubmitFilter('$!utils.escapeXML($!jslink.getPortletById($!portlet.ID))','$!portlet.ID');" 'auiSearch floatLeft' 'margin-right:1em;')
##<input class="text floatLeft" type="text" name="q" id="q" style="margin-right:5px;margin-top:2px;">
##ALsubmitOption("submit" "検索" "auiButtonSearch floatLeft")
##ALformfooter()
##</div>

#ALajaxIndicator("${indicator_id}" "$!{portlet.ID}" "")
#if($!msg_type)
#ALnoteResultList($msg_type)
#end

#ALajaxlistformheader('伝言メモ')
#if($result.List.size()<=0)
<div class="message">
#if($isReceive) 受信した伝言メモはありません。#else 送信した伝言メモはありません。 #end
</div>
#else

#AUISummaryDiv()
<div class="floatLeft">
#if($isReceive)
#AUIajaxbuttonCheckboxAction('既読にする' "$!jslink.getPortletById($!portlet.ID).addQueryData('template','NoteFormJSONScreen').addQueryData('mode','multi_complete')" "$indicator_id" "$!portlet.ID" "aipo.note.onReceiveMessage")
#AUIajaxbuttonCheckboxDelete('削除する' "$!jslink.getPortletById($!portlet.ID).addQueryData('template','NoteFormJSONScreen').addQueryData('mode','multi_delete')" "$indicator_id" "$!portlet.ID" "aipo.note.onReceiveMessage")
#else
#AUIajaxbuttonCheckboxDelete('削除する' "$!jslink.getPortletById($!portlet.ID).addQueryData('template','NoteFormJSONScreen').addQueryData('mode','multi_delete')" "$indicator_id" "$!portlet.ID" "aipo.note.onReceiveMessage")
#end
</div>
#AUIajaxpageview('NoteListScreen' $result)
#AUISummaryDivfooter()

#AUIrowTableWide()
<tr>
#ALtdheadThin("#ALswitchCheckbox()")
#if ($isReceive)
#ALtdheadThin("#ALajaxsort('note_stat' '状態' $result 'NoteListScreen')")
#end
#ALtdheadThin("#ALajaxsort('client_name' '依頼者' $result 'NoteListScreen')")
#ALtdheadW10('依頼者所属')
#ALtdheadW40("#ALajaxsort('subject_type' '用件' $result 'NoteListScreen')")
##ALtdheadThin('本文')
#ALtdheadThin("#if ($isReceive) 送信者 #else 受信者 #end")
#ALtdheadThin("#if ($isReceive) #ALajaxsort('accept_date' '受付日時' $result 'NoteListScreen') #else #ALajaxsort('create_date' '作成日時' $result 'NoteListScreen') #end")
</tr>
#set($setEven = true)
#foreach ($record in $result.List)
#ALsetSubject($record)
<tr #if(!$setEven) class="even" #end>
#ALsetEven($setEven)
#ALtdcellAtt("<input name='check$!record.NoteId' type='checkbox' value='$!record.NoteId'/>" 'class="center"')
#if($isReceive)
#if($record.NoteStat.toString() == "1" || $record.NoteStat.toString() == "2" || $record.NoteStat.toString() == "3")
#ALtdcellAtt("<img src='$record.NoteStatImage' alt='$record.NoteStatImageDescription' title='$record.NoteStatImageDescription'/>" 'class="center"')
#else
#tdcell('')
#end
#end
#ALtdcellheaderAtt('nowrap="nowrap"')
<a href="javascript:void(0);" onclick="aipo.common.showDialog('$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData("template","NoteDetailScreen").addQueryData("entityid",$record.NoteId))');">$!record.ClientName</a>
#ALtdcellfooter()
#ALtdcellAtt($!record.CompanyName 'nowrap="nowrap"')
#ALtdcellheader()
<div>$!subject</div>
#ALtdcellfooter()
##ALtdcellAtt("#if($!record.hasMemo()) 有 #else 無 #end" 'class="center"')
#ALtdcellAtt("#if ($isReceive) $!record.SrcUserFullName #else $!record.DestUserFullName #end" 'nowrap="nowrap"')
#ALtdcellAtt("#if ($isReceive) $!{record.AcceptDate.Month}月$!{record.AcceptDate.Day}日 $!{record.AcceptDate.Hour}時$!{record.AcceptDate.Minute}分 #else $!{record.CreateDate.Month}月$!{record.CreateDate.Day}日 $!{record.CreateDate.Hour}時$!{record.CreateDate.Minute}分 #end" 'nowrap="nowrap"')
</tr>
#end

#AUItablefooter()

#AUISummaryDiv()
<div class="floatLeft">
#if($isReceive)
#AUIajaxbuttonCheckboxAction('既読にする' "$!jslink.getPortletById($!portlet.ID).addQueryData('template','NoteFormJSONScreen').addQueryData('mode','multi_complete')" "$indicator_id" "$!portlet.ID" "aipo.note.onReceiveMessage")
#AUIajaxbuttonCheckboxDelete('削除する' "$!jslink.getPortletById($!portlet.ID).addQueryData('template','NoteFormJSONScreen').addQueryData('mode','multi_delete')" "$indicator_id" "$!portlet.ID" "aipo.note.onReceiveMessage")
#else
#AUIajaxbuttonCheckboxDelete('削除する' "$!jslink.getPortletById($!portlet.ID).addQueryData('template','NoteFormJSONScreen').addQueryData('mode','multi_delete')" "$indicator_id" "$!portlet.ID" "aipo.note.onReceiveMessage")
#end
</div>
#AUIajaxpageview('NoteListScreen' $result)
#AUISummaryDivfooter()

#end
#ALformfooter()

#AUIcontentsAreaFooter()
    
<div id="auiWidgetsArea">
<div class="auiWidget clearfix">
  <a title="伝言メモを作成する" href="javascript:void(0);" class="auiButtonAction" onclick="javascript:aipo.common.showDialog('$!jslink.getPortletById($!portlet.ID).addQueryData("template","NoteFormScreen").addQueryData("entityid","new")','$!portlet.ID',aipo.note.onLoadNoteDialog);">伝言メモを作成する</a>
</div>

<div class="auiWidget clearfix">
<h2>表示</h2>
<ul>
#if($isReceive)
<li class="active">
#else
<li >
#end
<a href="javascript:void(0);" onClick="aipo.viewPage('$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData('template','NoteListScreen').addQueryData('tab','received_notes'))','$!portlet.ID');">受信履歴</a></li>
#if($!result.currentTab == 'sent_notes')
<li class="active">
#else
<li >
#end
<a href="javascript:void(0);" onClick="aipo.viewPage('$!utils.escapeXML($!jslink.getPortletById($!portlet.ID).addQueryData('template','NoteListScreen').addQueryData('tab','sent_notes'))','$!portlet.ID');">送信履歴</a></li>
</ul>
</div>
</div>